<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        #ceshi {
            font-size: 50px;
        }
    </style>
</head>

<body>
    <div id="ceshi"></div>
    <script>
        function init() {
            if (window.DeviceMotionEvent) {
                // 移动浏览器支持运动传感事件
                window.addEventListener('devicemotion', deviceMotionHandler, false);

            }
        }

        // 那么，我们如何计算用户是否是在摇动手机呢？可以从以下几点进行考虑：
        // 1、其实用户在摇动手机的时候始终都是以一个方向为主进行摇动的；
        // 2、用户在摇动手机的时候在x、y、z三个方向都会有相应的想速度的变化；
        // 3、不能把用户正常的手机运动行为当做摇一摇（手机放在兜里，走路的时候也会有加速度的变化）。
        // 从以上三点考虑，针对三个方向上的加速度进行计算，间隔测量他们，考察他们在固定时间段里的变化率，而且需要确定一个阀值来触发摇一摇之后的操作。

        // 首先，定义一个摇动的阀值
        var SHAKE_THRESHOLD = 3000;
        // 定义一个变量保存上次更新的时间
        var last_update = 0;
        // 紧接着定义x、y、z记录三个轴的数据以及上一次触发的时间
        var x;
        var y;
        var z;
        var last_x;
        var last_y;
        var last_z;

        // 为了增加这个例子的一点无聊趣味性，增加一个计数器
        var count = 0;

        function deviceMotionHandler(eventData) {
            // 获取含重力的加速度
            var acceleration = eventData.accelerationIncludingGravity;

            // 获取当前时间
            var curTime = new Date().getTime();
            var diffTime = curTime - last_update;
            // 固定时间段
            if (diffTime > 100) {
                last_update = curTime;

                x = acceleration.x;
                y = acceleration.y;
                z = acceleration.z;

                var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 10000;

                if (speed > SHAKE_THRESHOLD) {
                    // TODO:在此处可以实现摇一摇之后所要进行的数据逻辑操作
                    count++;
                    document.getElementById("ceshi").innerHTML = count;

                }

                last_x = x;
                last_y = y;
                last_z = z;
            }
        }
        init()
    </script>
</body>

</html>